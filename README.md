# Инструкции по установке zOS

## Актуальное состояние на 25.04.2022

Развёрнуто 5 экземпляров эмулятора hercules, в домашней директории пользователя создан каталок под каждый экземпляр с полной копией образа zOS:
1. `zOS-0` содержит файл конфигурации hercules-0.cnf: настроен на подключение по порту 3270 с количеством CPU - 1
1. `zOS-1` содержит файл конфигурации hercules-1.cnf: настроен на подключение по порту 3271 с количеством CPU - 1
1. `zOS-2` содержит файл конфигурации hercules-2.cnf: настроен на подключение по порту 3272 с количеством CPU - 1
1. `zOS-3` содержит файл конфигурации hercules-3.cnf: настроен на подключение по порту 3273 с количеством CPU - 1
1. `zOS-4` содержит файл конфигурации hercules-4.cnf: настроен на подключение по порту 3274 с количеством CPU - 1

все экземпляры запущены при помощи screen.

Общие файлы: архив образа zOS, установочные файлы hercules и этот файл README, хранятся в домашней директории.

## Особенности настройки

Настроена возможность подключения всего 7 человек! Требуется дополнительная настройка терминалов в конфигурационном файле `hercules.cnf`.

## Предварительные требования к пользовательским машинам

1. Находиться во внутренней сети МГТУ им. Баумана или иметь активное VPN подключение
2. Установить эмулятор терминала 3270:
* Linux: пакеты `x3270 x3270-text`, запуск `c3270 <host>:3270`
* Windows: установить программу `x3270`, настроить подключение при запуске основной иконки и согласиться на конфигурирование новых иконок

## Последовательность установки и настройки

1. Скачать файлы на сервер
1. Установить эмулятор hercules `sudo dpkg -i hercules_3.13-7_amd64.deb`
1. Распаковать zOS `unzip zOS.113.s.2013.zip`, если требуется, установить пакет `zip`
1. Запустить эмулятор hercules `hercules -f hercules.cnf`
1. Запустить два экземпляра c3270: первый станет управляющим терминалом IPL, второй - терминалом TSO
1. Нажать в окне hercules **ESC**, затем **L** (переход в режим инциализации IPL) и **A** - выбрать первый загруженный образ диска для загрузки
1. Через некоторое время образ ОС будет загружен и на втором терминале отобразится приветствие
1. Вводим `logon ibmuser`, пароль `ibmuser`
1. Добро пожаловать в сессию TSO!

## Что дальше

### Повторное подключение

Если отключить все терминалы от сессии, то ничего не пропадёт. Первый подключенный терминал станет управляющим терминалом IPL: на нём отобразится приветсвие эмулятора hercules. Все последующие терминалы будут подключены как терминалы TSO: на них отобразится приветсвие zOS.

Если не выйти из сессии в предыдущем терминале, то после повторного подключения и ввода пароля будет выведено сообщение об ошибке. Достаточно ввести `logoff` чтобы выйти, затем `logon` для повторного входа. Система знает что Вы знаете свой пароль.

### Запуск в фоновом режиме

Для запуска в фоновом режиме воспользуемся программой screen. Это позволит отделить процесс эмулятора hercules от процесса bash, связанного с текущей сессией ssh.

1. Зафиксировать у себя в памяти состояние вывода `pstree`
1. Создадим новую сессию `screen`. Завершить сессию можно при помощи нажатия **SPACE** или **ENTER**
1. После создания сессии, pstree дополнится новым процессом screen, связанным с текущей сессией.
1. Создадим новое окно **CTRL+a** затем **c**. На будущее: просмотр всех окон **CTRL+a** и **w**, а для промотра всех окон с возможность выбор **CTRL+a** и **"** (**SHIFT+'**)
1. В новом окне запустим эмулятор hercules. Теперь от текущей сесси можно спокойно отключаться.
1. После повторного подключения (или во второй сесси ssh) процесс screen будет перенесён отдельно от текущего пользователя и станет новым корневым процессом. Остановки эмулятора hercules не произойдёт.
